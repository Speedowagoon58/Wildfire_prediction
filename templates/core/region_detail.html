{% extends 'base.html' %} {% load static %} {% block title %}{{ region.name }} -
Wildfire Prediction System{% endblock %} {% block content %}
<div class="row">
  <div class="col-md-8">
    <div class="card mb-4">
      <div class="card-header">
        <h2 class="card-title mb-0">{{ region.name }}</h2>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <h4>Location Details</h4>
            <p><strong>Latitude:</strong> {{ region.latitude }}</p>
            <p><strong>Longitude:</strong> {{ region.longitude }}</p>
            <p>
              <strong>Elevation:</strong> {% if region.elevation %}{{
              region.elevation }} m{% else %}N/A{% endif %}
            </p>
          </div>
          <div class="col-md-6">
            <h4>Statistics</h4>
            <p><strong>Total Events:</strong> {{ events|length }}</p>
            <p>
              <strong>Last Updated:</strong> {{ region.updated_at|date:"F j, Y"
              }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h3 class="card-title mb-0">Wildfire Events</h3>
      </div>
      <div class="card-body">
        {% if events %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Date</th>
                <th>Severity</th>
                <th>Area Affected</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for event in events %}
              <tr>
                <td>{{ event.start_date|date:"F j, Y" }}</td>
                <td>
                  <span
                    class="badge bg-{% if event.severity == 1 %}success{% elif event.severity == 2 %}warning{% elif event.severity == 3 %}danger{% else %}dark{% endif %}"
                  >
                    {{ event.get_severity_display }}
                  </span>
                </td>
                <td>{{ event.area_affected }} km²</td>
                <td>
                  {% if event.end_date %} Ended {{ event.end_date|date:"F j, Y"
                  }} {% else %} Active {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p>No wildfire events recorded for this region.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card mb-4">
      <div class="card-header">
        <h3 class="card-title mb-0">Current Weather</h3>
      </div>
      <div class="card-body">
        <div id="weather-data">Loading weather data...</div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h3 class="card-title mb-0">Risk Assessment</h3>
      </div>
      <div class="card-body">
        <div id="risk-assessment">Loading risk assessment...</div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Fetch weather data
    fetch(`/api/weather/weather/${region.id}/fetch_current_weather/`)
      .then((response) => response.json())
      .then((data) => {
        document.getElementById("weather-data").innerHTML = `
                <p><strong>Temperature:</strong> ${Math.round(
                  data.temperature
                )}°C</p>
                <p><strong>Humidity:</strong> ${Math.round(data.humidity)}%</p>
                <p><strong>Wind Speed:</strong> ${Math.round(
                  data.wind_speed
                )} m/s</p>
                <p><strong>Last Updated:</strong> ${new Date(
                  data.timestamp
                ).toLocaleString()}</p>
            `;
      })
      .catch((error) => {
        document.getElementById("weather-data").innerHTML =
          "Error loading weather data";
        console.error("Error:", error);
      });

    // Fetch risk assessment
    fetch(`/predictions/api/results/predict-for-region/`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ region_id: {{ region.id }} })
    })
      .then((response) => response.json())
      .then((data) => {
        const riskLevel = data.risk_level === 'High Risk' ? 100 :
                         data.risk_level === 'Medium Risk' ? 50 : 25;
        const riskColor = data.risk_level === 'High Risk' ? 'danger' :
                         data.risk_level === 'Medium Risk' ? 'warning' : 'success';

        document.getElementById("risk-assessment").innerHTML = `
                <div class="text-center">
                    <h4 class="text-${riskColor}">${riskLevel}%</h4>
                    <p>Current Risk Level</p>
                    <div class="progress">
                        <div class="progress-bar bg-${riskColor}"
                             role="progressbar"
                             style="width: ${riskLevel}%"
                             aria-valuenow="${riskLevel}"
                             aria-valuemin="0"
                             aria-valuemax="100">
                        </div>
                    </div>
                    <p class="mt-2"><small>Confidence: ${Math.round(data.confidence)}%</small></p>
                    <p class="mt-2"><small>${data.explanation}</small></p>
                </div>
            `;
      })
      .catch((error) => {
        document.getElementById("risk-assessment").innerHTML =
          "Error loading risk assessment";
        console.error("Error:", error);
      });
  });
</script>
{% endblock %}
