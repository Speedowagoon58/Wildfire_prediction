{% extends "base.html" %} {% load static %} {% block title %}Wildfire Risk
Dashboard{% endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
/>
<style>
  #map {
    height: 400px;
    width: 100%;
    margin-bottom: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    position: relative;
    z-index: 1;
    cursor: grab;
  }
  #map:active {
    cursor: grabbing;
  }
  .risk-legend {
    background: white;
    padding: 10px;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    position: absolute;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
  }
  .risk-legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
  }
  .map-container {
    position: relative;
    margin-bottom: 2rem;
  }
  .leaflet-control-zoom {
    border: none !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
  }
  .leaflet-control-zoom a {
    background-color: white !important;
    color: #333 !important;
    border: none !important;
  }
  .leaflet-control-zoom a:hover {
    background-color: #f8f9fa !important;
  }
  .leaflet-interactive {
    cursor: pointer !important;
  }
</style>
{% endblock %} {% block content %}
<div class="dashboard-container animate-fade-in">
  <h1 class="mb-4">Regional Risk Assessment</h1>

  <!-- Map Container -->
  <div class="map-container hover-lift mb-4">
    <div id="map"></div>
    <div class="risk-legend">
      <h4>Risk Levels</h4>
      <div class="d-flex flex-column">
        <div class="mb-2">
          <i style="background: #dc3545"></i>
          <span>High Risk</span>
        </div>
        <div class="mb-2">
          <i style="background: #ffc107"></i>
          <span>Medium Risk</span>
        </div>
        <div>
          <i style="background: #28a745"></i>
          <span>Low Risk</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Risk Cards Grid -->
  <div class="row g-4">
    {% for prediction in regions %}
    <div class="col-md-6 col-lg-4">
      <div
        class="card h-100 hover-lift animate-slide-in"
        style="--delay: {% widthratio forloop.counter 25 1 %}s"
      >
        <div class="card-body">
          <h5 class="card-title">{{ prediction.region.name }}</h5>
          <div
            class="risk-indicator {% if prediction.risk_level == 'high' %}high{% endif %}"
          >
            <div class="d-flex justify-content-between align-items-center mb-3">
              <span class="badge bg-{{ prediction.risk_color }} animate-pulse"
                >{% if prediction.risk_level == 'low' %}Low Risk{% else %}{{
                prediction.risk_level_display }} Risk{% endif %}</span
              >
            </div>
          </div>
          <p class="card-text">{{ prediction.explanation }}</p>
          <div class="mt-3">
            <small class="text-muted"
              >Last updated: {{ prediction.timestamp }}</small
            >
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12">
      <div class="alert alert-info animate-fade-in" role="alert">
        No predictions available at the moment.
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %} {% block extra_js %}
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Initialize map
      var map = L.map('map').setView([31.7917, -7.0926], 6);

      // Add tile layer with animation
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);

      // Add markers with animation
      {% for prediction in regions %}
      var marker = L.circleMarker(
          [{{ prediction.region.latitude }}, {{ prediction.region.longitude }}],
          {
              radius: 10,
              fillColor: getRiskColor('{{ prediction.risk_level }}'),
              color: '#fff',
              weight: 2,
              opacity: 1,
              fillOpacity: 0.8
          }
      ).addTo(map);

      // Add bounce animation on hover
      marker.on('mouseover', function() {
          this._path.classList.add('marker-bounce');
      });
      marker.on('mouseout', function() {
          this._path.classList.remove('marker-bounce');
      });

      // Add popup with animation
      marker.bindPopup(`
          <div class="animate-fade-in">
              <h6>${ '{{ prediction.region.name }}' }</h6>
              <span class="badge bg-{{ prediction.risk_color }}">
                  ${ '{{ prediction.risk_level }}' === 'low' ? 'Low Risk' : '{{ prediction.risk_level_display }} Risk' }
              </span>
              <p class="mt-2 mb-0"><small>${ '{{ prediction.explanation }}' }</small></p>
          </div>
      `);
      {% endfor %}

      function getRiskColor(risk) {
          return risk === 'high' ? '#dc3545' :
                 risk === 'medium' ? '#ffc107' :
                 '#28a745';
      }

      // Add skeleton loading animation
      function showSkeletonLoading() {
          document.querySelectorAll('.card').forEach(card => {
              card.classList.add('skeleton');
          });
      }

      function hideSkeletonLoading() {
          document.querySelectorAll('.card').forEach(card => {
              card.classList.remove('skeleton');
          });
      }

      // Simulate loading state
      showSkeletonLoading();
      setTimeout(hideSkeletonLoading, 1000);
  });
</script>
{% endblock %}
